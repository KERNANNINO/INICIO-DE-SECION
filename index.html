<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Inicio de Sesi√≥n y Registro</title>
    <link rel="stylesheet" href="css\styles.css">
    
</head>
<body>
    <div class="contenedor">
        <div class="caja-inicio">
            <h1>Iniciar Sesi√≥n</h1>
            <form id="formularioInicio">
                <label for="usuarioInicio">Nombre de Usuario:</label>
                <input type="text" id="usuarioInicio" name="usuarioInicio" required>
                
                <label for="contrase√±aInicio">Contrase√±a:</label>
                <div style="position: relative;">
                    <input type="password" id="contrase√±aInicio" name="contrase√±aInicio" required>
                    <span class="mostrar-contrase√±a" onclick="mostrarContrase√±a('contrase√±aInicio')">üëÅÔ∏è</span>
                </div>
                
                <button type="submit">Iniciar Sesi√≥n</button>
                <div class="enlaces">
                    <a href="#" onclick="mostrarRegistro()">Crear una nueva cuenta</a>
                    <a href="#" onclick="mostrarRecuperarContrase√±a()">¬øOlvidaste tu contrase√±a?</a>
                </div>
                <p class="error oculto" id="mensajeError">Demasiados intentos fallidos. Por favor, int√©ntelo m√°s tarde.</p>
                <p class="success oculto" id="mensajeExitoInicio">Inicio de sesi√≥n exitoso.</p>
            </form>
        </div>
        
        <div class="caja-registro oculto" id="cajaRegistro">
            <h2>Crear Cuenta</h2>
            <form id="formularioRegistro">
                <label for="nombre">Nombre:</label>
                <input type="text" id="nombre" name="nombre" required>

                <label for="apellido">Apellido:</label>
                <input type="text" id="apellido" name="apellido" required>

                <label for="fechaNacimiento">Fecha de Nacimiento:</label>
                <input type="date" id="fechaNacimiento" name="fechaNacimiento" required>

                <label for="correoRegistro">Correo Electr√≥nico:</label>
                <input type="email" id="correoRegistro" name="correoRegistro" readonly required>

                <label for="contrase√±aRegistro">Contrase√±a:</label>
                <div style="position: relative;">
                    <input type="password" id="contrase√±aRegistro" name="contrase√±aRegistro" required>
                    <span class="mostrar-contrase√±a" onclick="mostrarContrase√±a('contrase√±aRegistro')">üëÅÔ∏è</span>
                </div>

                <label for="deporteFavorito">¬øCu√°l es tu deporte favorito?</label>
                <input type="text" id="deporteFavorito" name="deporteFavorito" required>

                <button type="submit">Crear Cuenta</button>
                <p class="success oculto" id="mensajeExitoRegistro">Cuenta creada con √©xito. Ahora puedes iniciar sesi√≥n.</p>
            </form>
        </div>

        <div class="caja-recuperar-contrase√±a oculto" id="cajaRecuperarContrase√±a">
            <h2>Recuperar Contrase√±a</h2>
            <form id="formularioRecuperarContrase√±a">
                <label for="correoRecuperar">Correo Electr√≥nico:</label>
                <input type="email" id="correoRecuperar" name="correoRecuperar" required>
                <label for="preguntaSeguridad">¬øCu√°l es tu deporte favorito?</label>
                <input type="text" id="preguntaSeguridad" name="preguntaSeguridad" required>
                <label for="nuevaContrase√±a">Nueva Contrase√±a:</label>
                <input type="password" id="nuevaContrase√±a" name="nuevaContrase√±a" required>
                <button type="submit">Enviar</button>
                <p class="success oculto" id="mensajeExitoRecuperar">Contrase√±a restablecida con √©xito.</p>
                <p class="error oculto" id="mensajeErrorRecuperar">El correo electr√≥nico o la respuesta de seguridad no son correctos.</p>
            </form>
        </div>
    </div>

    <script>
        let intentosInicio = 0;
        const maxIntentos = 3;

        function mostrarRegistro() {
            document.querySelector('.caja-inicio').classList.add('oculto');
            document.getElementById('cajaRegistro').classList.remove('oculto');
        }

        function mostrarRecuperarContrase√±a() {
            document.querySelector('.caja-inicio').classList.add('oculto');
            document.getElementById('cajaRecuperarContrase√±a').classList.remove('oculto');
        }

        function mostrarContrase√±a(campoId) {
            const campoContrase√±a = document.getElementById(campoId);
            const tipoCampo = campoContrase√±a.getAttribute('type');
            if (tipoCampo === 'password') {
                campoContrase√±a.setAttribute('type', 'text');
            } else {
                campoContrase√±a.setAttribute('type', 'password');
            }
        }

        document.getElementById('nombre').addEventListener('input', generarCorreo);
        document.getElementById('apellido').addEventListener('input', generarCorreo);
        document.getElementById('fechaNacimiento').addEventListener('input', generarCorreo);

        function generarCorreo() {
            const nombre = document.getElementById('nombre').value;
            const apellido = document.getElementById('apellido').value;
            const fechaNacimiento = document.getElementById('fechaNacimiento').value;
            let correo = '';

            if (nombre && apellido && fechaNacimiento) {
                const a√±o = new Date(fechaNacimiento).getFullYear().toString().slice(-2);
                const correoNombre = nombre.slice(-4).toLowerCase();
                const correoApellido = apellido.slice(0, 3).toLowerCase();
                correo = `${correoApellido}${correoNombre}${a√±o}@gmail.com`;
                document.getElementById('correoRegistro').value = correo;
            }
        }

        document.getElementById('formularioRegistro').addEventListener('submit', function(event) {
            event.preventDefault();

            const usuarios = JSON.parse(localStorage.getItem('usuariosRegistrados')) || [];

            const correo = document.getElementById('correoRegistro').value;
            const contrase√±a = document.getElementById('contrase√±aRegistro').value;
            const deporteFavorito = document.getElementById('deporteFavorito').value.toLowerCase();

            console.log('Datos Registro:', { nombre: document.getElementById('nombre').value, apellido: document.getElementById('apellido').value, fechaNacimiento: document.getElementById('fechaNacimiento').value, correo, contrase√±a, deporteFavorito });

            const regexContrase√±a = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[@$!%*?&.,_-]).{8,}$/;

            if (!regexContrase√±a.test(contrase√±a)) {
                alert('La contrase√±a debe tener al menos 8 caracteres, incluyendo letras, n√∫meros y caracteres especiales.');
                return;
            }

            usuarios.push({ correo, contrase√±a, deporteFavorito });
            localStorage.setItem('usuariosRegistrados', JSON.stringify(usuarios));

            document.getElementById('mensajeExitoRegistro').classList.remove('oculto');

            setTimeout(() => {
                document.getElementById('cajaRegistro').classList.add('oculto');
                document.querySelector('.caja-inicio').classList.remove('oculto');
            }, 2000);
        });
        document.getElementById('formularioInicio').addEventListener('submit', function(event) {
            event.preventDefault();

            if (intentosInicio >= maxIntentos) {
                document.getElementById('mensajeError').classList.remove('oculto');
                return;
            }

            const usuarioInicio = document.getElementById('usuarioInicio').value.toLowerCase();
            const contrase√±aInicio = document.getElementById('contrase√±aInicio').value;

            console.log('Datos Inicio:', { usuarioInicio, contrase√±aInicio });

            const usuarios = JSON.parse(localStorage.getItem('usuariosRegistrados')) || [];
            const usuario = usuarios.find(u => u.correo === usuarioInicio && u.contrase√±a === contrase√±aInicio);

            if (usuario) {
                document.getElementById('mensajeExitoInicio').classList.remove('oculto');
                intentosInicio = 0;
            } else {
                intentosInicio++;
                if (intentosInicio >= maxIntentos) {
                    document.getElementById('mensajeError').classList.remove('oculto');
                } else {
                    alert(`Correo o contrase√±a incorrectos. Intento ${intentosInicio} de ${maxIntentos}.`);
                }
            }
        });

        document.getElementById('formularioRecuperarContrase√±a').addEventListener('submit', function(event) {
            event.preventDefault();
            const correoRecuperar = document.getElementById('correoRecuperar').value;
            const respuestaSeguridad = document.getElementById('preguntaSeguridad').value.toLowerCase();
            const nuevaContrase√±a = document.getElementById('nuevaContrase√±a').value;

            console.log('Datos Recuperar:', { correoRecuperar, respuestaSeguridad, nuevaContrase√±a });

            const usuarios = JSON.parse(localStorage.getItem('usuariosRegistrados')) || [];
            const usuario = usuarios.find(u => u.correo === correoRecuperar && u.deporteFavorito === respuestaSeguridad);

            if (usuario) {
                const regexContrase√±a = /^(?=.*[a-zA-Z])(?=.*\d)(?=.*[@$!%*?&.,_-]).{8,}$/;

                if (!regexContrase√±a.test(nuevaContrase√±a)) {
                    document.getElementById('mensajeErrorRecuperar').textContent = 'La nueva contrase√±a debe tener al menos 8 caracteres, incluyendo letras, n√∫meros y caracteres especiales.';
                    document.getElementById('mensajeErrorRecuperar').classList.remove('oculto');
                    return;
                }

                usuario.contrase√±a = nuevaContrase√±a;
                localStorage.setItem('usuariosRegistrados', JSON.stringify(usuarios));
                document.getElementById('mensajeExitoRecuperar').classList.remove('oculto');
                
                setTimeout(() => {
                    document.getElementById('cajaRecuperarContrase√±a').classList.add('oculto');
                    document.querySelector('.caja-inicio').classList.remove('oculto');
                }, 2000);
            } else {
                document.getElementById('mensajeErrorRecuperar').classList.remove('oculto');
            }
        });
    </script>
</body>
</html>
